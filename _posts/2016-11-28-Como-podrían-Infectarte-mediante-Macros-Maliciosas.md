---
layout: post
title: "Como podrían infectarte mediante macros maliciosas"
quote: "Hacking General"
image:
      url:/assets/images/fondo.jpg
video: false
comments: true
theme_color: 302F2D
---

Los ataques mediante macros siguen aumentando, creo que es una de las técnicas más usadas hoy en dia para engañar a los usuarios para lograr 
su objetivo.

La mayoría de los usuarios puede que nunca haya visto ni oído hablar de este tipo de infección mediante macros maliciosas sin embargo estos 
métodos de infección se vienen usando desde hace ya algunos años solo que también se han ido mejorando los métodos de infección.


Como el Ransonware llamado Locky  que se propaga en el sistema a través de un macro malicioso en un documento de Word una vez infectado encripta 
los archivos como documentos, imágenes etc con extensión .locky junto con una nota de rescate y se tiene que pagar mediante Bitcoins para el rescate de los archivos.


Que es un Ransonware y como protegerte [VER VIDEO](https://www.youtube.com/watch?v=xpFU4n2iHN8).

##POC Documento Malicioso
Es momento de empezar con nuestra prueba de concepto para eso usare una presentación en PowerPoint donde insertare una macros maliciosa, 
aunque también se podrían usar documentos como Word o Excel.

En este caso he generado dos archivos uno llamado `powershell_attack.txt` que es donde contiene la macros maliciosa y `unicorn.rc` está la usare para poner la conexión a la escucha.
{% include image.html url="https://lh3.googleusercontent.com/Wp1LByh-mjafXCWCzW8Xk7d73QRDdNier3_QNf13YZelS3WIA6e5L945xFffAxm6m2qENN5XasP6Aq_vzuoTA9b5Vb30hx7NZezZWtxTjKUL8bLdv-0wSbhO-FU5QkgP8xsR3X3jNifyFd3F176phsinOt86zyfLDktcrj0f7NA_3k2HfneCI7oWiDdriqZ6mfhhfBoJtBjAVhCrnpMbI3c9btup6DHDBdU-HRDw6_CpGe5LjEaP2b1tAtWumdGL1Kt40mXGjkrk66kIZORMDO-Rh-hOH8O_e8GaSJBUzZIs3gm9LhQxiUCXUdWaTXYxW1BTl9Ldag-V_FpkD_zQXLj6C-lHMTLX1THIM_1mUGINacdthTgvB0T277HAKv6lYBgWqFMrnbUouq-8Xv7WRWkGM-nsT5Kis5--vGciceIKedz6G_rLWjjNe0tp5Yxuu6hJZGIdU2koVJZok33r_d5LCNZWn_FGY5DCnY0D36-K2j6YPFWmXZVDojyZ15TwQ6FabrTnGCES2vtRZztACm89qPaboLettnbt-5WNB6ErDWUWL6U81Ac-GQcx3kdgGu-YWNNILHQI1JX_EEvudefZj7O56gZHBz58oUgNxQrX8HNb=w872-h574-no" %}

Ahora pasare a Windows y creare una presentación en PowerPoint, como ejemplo solo he puesto una imagen religiosa, me voy a la opción macros y creo uno nuevo.
{% include image.html url="https://lh3.googleusercontent.com/gUzwkuIE--KjEX97rs1gUIt-QmVeBvpBvPIF4Gq2R1XMHPR_5Agl04-aMrBEsTlEWXBp1GM6cZ4YvozU_oqRPFib1rzO5mpA6MvRi8p_DXnKzckx29lvvHvTS_irdnPvf1NGAME7zIk0KPOKnjQZ0lH3xw9buC3cupwjsSytQpo9pNVTNzYwqtYJORXJ-yGy6XTxBK9j_x3WAl6dqnKWWp3-3AFsiDIaaYnaLuz2rx4DDf8ZlQ_z85Xhp-c7lYK3wZsdSK0UmsjzcLtOIfy037LCOdoqUmOou1R1QJ9Ec4vz7iWaJQBVtXe9U1Gcq-w_O_d1q9RndTLF888ZK10UmZo8FKCGzJIeWg474uURkG48U8pk9gj6bNQ-1po_K0wYOq_M8_2uE9ZpS6NW8YZHOPEyIuerEWH1y6hTwaqn0Rtszio_6EuiBsNW525vLR2U0jmURHOXoXEwQJ7YexEObUGUDoyqp2_KqGit8F0FHfAEAv4-TuLDvX_N_XtlxqBkuEHgD2Fo1IFFrIFQMeJmddc5rEiCnSgEmHMuiSvZUCmMnVXtGClh2LsW1niI0lh0yIlPevfaPDevt3o0dGXLPN3Iu1K3QO3u3W8EBiJ8xX7Gb8lO=w1178-h662-no" %}

Abrirá el editor de Microsoft Visual Basic para Aplicaciones, aquí pondré el código de la macros maliciosa que lo tengo en el archivo llamado `powershell_attack.txt`, quedara de esta manera:
{% include image.html url="https://lh3.googleusercontent.com/vynZ4sNdZJ2nXBd2Ut7bVGlyHyv2dvqG0UBQxiV0jmvp3dOhleJxhTp3g0d-dmv5pKHrsxGRVD9yb2HVFFwG5WHQN1llOWyERZ6t6mGF-anMXeg9qklD-3xB6RERJQ5ok2stJoXkEQm6vY5LACBCp7Mk0ZkVssQJ1nqFGepTbpgZ3YEVqpSHyEFn12yPs1fK1YC09y6D0THiCpIFKAZLM1IcYLsAEDOZAy4dZSCnVoKM5AVUsSDqmZVogp1s5L2McjH1bW8jVOqOGrPH5DuQbyRa00NM2t_Fz1zXWV7V6D4oBYkmBFPHCcFGq_OkaAyQbChL0OJPNoPWzwxFKa4PxPFkwmh1e0_-GUmG33xI-wQ5PXTcOA_sYSLH-VofVryInnrW6sdq1XiFVt4G8eVd9f9LgskrgppFk19YbHIay8m7sHXC9mR-dKJ4FI2nZRkMFp5uttZ7pAtbSAHJsaZDPPXNH9zzcrXQe8dx_UqSOsWYsRZ2gUFuZHIp8oPN8zZ12_4gtfkkw9XlJ2v2Iu5tT-Iv2Y7-7-KS-rzMplayTT1047-A2djknxkhKsaMtTEdCdCtf_wswJV3im0qcVeTCkgtlfm_drkSM5FWHg6_7Xc6ti03=w1178-h662-no" %}

Y se guarda como `Presentación con Diapositivas de PowerPoint habilitada para macros`, con esto estamos habilitando las macros.
{% include image.html url="https://lh3.googleusercontent.com/DtCJGWDul2SRZF2l2Mg_HPLGo6dOUOL9IFm_JJV8dCLpHHj6QzW66R7xwjBYEi2PUHWESSiZYuIAxIadFAwk7Q3fHMvpWqw-0i93gtpfr8RoP6Q9FNuT-qTUZJxRQrhOwb5JcNKM3huKxyc3M5SnNN4OomitzjVLFx-iIyaNQrFcR_CBjuXblaGL6FVh4_5PJ9px745bRVDEUAjsVrreinYm8Mi5FdU_Tq4dlWtO79M2xBdbbJ1H230GPrezp7-CME3dSulsrYG9xj6v4qQoWMXcgCpyrw8bhA7idcSH5qcPIIsSh9Iod61KDaYUMmXD3D1fKY3eC8jDyIE8d1hltmgrZ27sLRBfPeGjbdFLoqfk5UquhyaAp0JOhOPvtWVEG-GsZMvfIoitVR13I4L5ycSHxjm7YJxXK9jSt5kD0u_uEzag30s_oeUCOldbYI3mPzXeZ_Q0nkUONm6eM3HTY2qhSbGBEaOpyCEscgYSYPbjyXstgxHzHAjVmc8EcQ3qVO7aHZmtDM_vpwgEb-qJy2OieL3uI83yvprJMwazb7a6HVs6trHHIC4UMjdhiYX1SnsSW89nZ9HCFOYKRAgCxk98FovS9TRDXRHbxyxzmPVt24Qe=w683-h480-no" %}

Solo toca configurar la presentación, para que la macro se ejecute una vez que el usuario pulse en la imagen XD.
Selecciono la imagen y me voy a la opción Acción
{% include image.html url="https://lh3.googleusercontent.com/T2RYK8zgOXcO93huSctEyafOpQujFgHt9fwMiAbPtL16yoCen87Q5ybyW8A_ORUa9lTZwYgdbJemSRT9lqN0A9ZWhSaz7zE5kfVDwv8C2TVGQK1Wp7c6Tiedpza4WkHwKtKiawrTtOJVLuDu4GRd1Ah8QceNYMVmaYu9iA-rfMfbW1hSrNwvDWXZiMXDD1XyrpVT4XTjo5TMjyNwjQoLEbzFlyJqPafbc8nt39vYJmlFLl46uCmUR-4c3SEqUSb_xg9Ac7P11IcRM_S04XsS6CpPhWKxZYRsrv8NYzR0UhsD7-U-HsFBk3Lnx-bNtFqtkKDM-iA6S6GkdfnIrICq74FULLGCaDXkgd3_-zgGhtXFRajM2BxcRWq-e-L-pwu4EROMxJPPbUnpnFK8qIJ6laCseJFJAEcZUD6VZBorsBz4GNyRkM2JlI8vgEji2WZtkEjfRIDVNR3pM_5mRWOkupVwGnpiPt--WebmFeeREqWdsTIDwFryC_cuR02429Dw64Zb10Zl52xcIqqb13mVmu4vTLMt7Jd1jIV6ny9bA0tlFOnEGE72TVXkzDNsw8OXD6ihMHFzewzdvZdPKTsuukGmhzjuqSjcW6yfZoWGBZy70KV7=w1178-h662-no" %}

Mostrará  la siguiente ventana de configuración de acción esta quedara de la siguiente manera:
{% include image.html url="https://lh3.googleusercontent.com/2XvddsmQX_R9l0_20oKRTQV64kVdiNawyNRiUR3g2FRzvb8HygOPLs2yDy7LL87Xx2xIq9kQ5XJsx6gInbJe-uoxqFvycEl9ZilZefdGMceS7WJb5jXbK36rkDEGxv3SsAzuGNuJ7qMqXaSwdKgXT2Ry6ccIepGdsW_l7tDd8Tmxf-ZnTVYNq6nbAcGSV8YY8VHWoNS1Fb1xi3kFGZWRK5ZwACwXOWzfXtvk8HCvTD4ox4b4vgh4OdHEM_AxpUPvuJjsyvIoVMSAjSqQM9WhagoJ2d9FfJR6r4gx3ybuZrLCj4AD57zUuc4B_RIlvApf4KbDrnjRcIOhBezJXD6FvJIjqCH3N8W2NqbvWIU1r7Ct-dNmePu-aTCYtB5Jk1iQU7g2qPSQZzzHKxR7YgLKcNMLVGlGgBC57ma_9qP78wONDzySzQNlXyDGuEmHkGuzk__EnIwMorZ87hbrj5krk9p_nTNQhckuBhAbWLlqIV5EsXIOnl_-2RNyGCb5RPsyW0oM5IpTZ2llL-sq42Tl1Zhytqp3ae5eGUaxwgw4-onWMMb6l9jmXPt7c8luujsuXqKAZyvQFWwZJcXe93fo7IpfC5Z4yVUqmtBefuKUfxnqasxo=w368-h409-no" %}
Y con esto ya tendría mi documento malicioso y está listo para ser distribuido lol.
{% include image.html url="https://lh3.googleusercontent.com/HcgLMeEMAElG1suTwjEawBHujld6rR6eXiGunDy5GjTJgUSP3UIoW_gLECHJG1y5pJoRfcgCv30nvSgYSBVUZfc5IOot7S-q6QKBW67eFIVZ8OfSesJby-ZE1at73KR4F9SwZsdVEVGQO_l97KbGMuDm2QgVfgcVN0JRpcJr9f7e68Febvecl8cDj9E-yfBe8dE3vrXwUDqYeqI4W8KwME5oj1eqItG8oXa5qXxQmvSkSM1Kn_gI4jhMW9Jm0g28zZxidFNXJswgZSZjQgoVm-n-FaSey6s_8jxFhknX7aFaR3dZusa5fXITTw6ZY86cKghsO30c2YnXjrYEYYJo1XVufR7TtO1Ib8tku1A4S6xWoWk3inTFylZEQkqmaw0kfwX1WzhQc8DQQvnK1YybB-jYGOZ-0NcBNRme9NXlFXwAW2_45k6w8kkigQQvXUfAqifRj9XHCbPmmZEzZP3E6DFlo5_dMGnKOj4aAZXQT-ofLSwgtQLOtIJ1wtG5BV8HwVaLeGbl4seHsCvpnEAa8YKDfpZcCgHid5a-cwcLki9S3Ijm4c6RKKfF0RA9Y7OWGN3dkU6lxmtYwkKPqVbKP-5TtoMS_tuVeIv4EjjsCaV9yKEG=w844-h305-no" %}

Por otro lado, el atacante tendrá una sesión a la escucha
{% include image.html url="https://lh3.googleusercontent.com/X03Be2LloSrw7xM7thYQNQIkBzyuOZwFnkPnonBDH4Ss57JMjx-M3m1Dm2CXArZoOPlrhc_i4qj-UxwK11s2kQVEyJcRhzuHyPDn7nbP3Gxn_eRMaY9WBNtJ0WN0TRFv316f1U2eOkeBftouSOH4Wg3kq5ubyOVKvK6tZu0Gx-DQsWW-uXPqS3zfcUL6kWaKVFwz-cd-rr3D6useVbsc1VW6IXwfNNRWTBeuAHny0fxsDxRKwSgla6BvwP7oj0x16jjDolj3n_FQ7w-W43qGfLk_6ODcjMN10_QBk7iXtipGMEgYPEKEadgDC2l3aS9XCImOM2p282IR-IqkQDJIIdRO2OrZ7U11hUha6d8mCaen-npH4F3taTI2Zr0YyrJJ7iOsBBZwOkH2qum6fNX3jMnHLuS71yiP7EN4UktCdxieAjlp9uvC1ZHxhKoRHmSzmRVyHaDwOImIiDcAruCvt2bHq_CFGJoL20ga0dtLfRdPJDuewpCScWPQL_p0u07OlgPdC8LG9Abiei0PDLVeD8KwKMym_XHbPsFuS8u3p2W_vV37xDYEKf2xEHn47_wi3r-CV68N1eN4Otr4j7vNsE3_sQkmzhCkhngEPDKWlG0ZsAbb=w778-h502-no" %}

Una vez que la víctima abra la presentación y pulse en la imagen automáticamente saltará un mensaje de error y se nos cerrará la presentación.
{% include image.html url="https://lh3.googleusercontent.com/S5lE06mS8Lpb12uI6UuAuWB0-Opn_3yViTym7RMMYtHIwYMZtf6ZoTiz9x8ynCCTHM-24N2L3X1AHlT8cFUv1Nkm_WpT_f6_8a3hLjMXwODIuKZMNRv3T7c_V5JreKm_Y-6IBj4w1gfkE83npwzWZocxAgKf5mX1P5N2pjq7gS1OYwfzhfLa6RzGycCsEs6EotYGthtQ_AjcoUH_It_WRtKkIzSv1LbaKgvwkR3h3acZ2behlAPzFyBn--HfchFTTntZDd9b2Uj56P22UufWEb7sPthlgx6loCyoqv98JpqycslEDvu0cauWqcQ_A0AgyOmlALmIyJFSrT_UAW3tVcMKlPqSeNplz6wYnVMM2jOHXIzDKKLbJEuvySSo0g_dgd516x_kJXuld9vhisjBxdQccR9NiSBKV874rokobgoZzIJWuJPRl26dA4Tz9PjxjcC9M9RDGI57b2S6e4iVW2YcfoymQ2gfJUc-5LeqvXlKqhXJEdwX7ey-mbjLpercLjuK4NpW8N4-PsG3oDnBGh4AG8m_Kgyz210qwvAQIYJfxxkqELgWWPBmspqrx3s3EvajGIQFYbxpWdSwG53TjR1p-kOspACnXV-d6CTAf1lHF0e0=w1178-h662-no" %}

Y el atacante obtendrá una sesión meterpreter y cabum ya estamos dentro del sistema winbugs XD.
{% include image.html url="https://lh3.googleusercontent.com/dDLN6JHtoXA4xKd88KRSKMbAVGbeZ5oUwAuDvv9Mtz_JkN8zldXtK70qU5-3nUpg4-T2mk2Tug3l0S0t6a_xnDeC9M7c54BVXsGJ6gpdU75DU3uGk1qqZTzosxn8fZ4Y0Wj8k6tR_YoLzyuO7RZif0VXl9nSEKfj2OjZH3jgJwbnre7JUOSvY16hKQkIh9dStrGLPBR6kj7cN-gFqwv9vv1Anm2D8P-WfJkGDQtF0ye4Ur-Iy4eZ9gpTtxIohZA3uSCTEIOjOuXcDqxX2996eB6WZFbdGRuR-0GLcezBh3P5V5jX0jmIAXzlwaieZDlS248mMY8afi4YTqVB0nTAy0asXeFU6-GY9LzeQm3A9_T21lKP6FWbGWqZ4JrsMW0Rp4np2uuw6vqgKFgNkioJlST4ttiGhiULYgc3xyS673wfV5jwG4lPrb8r_l257c5n7k7p8lVJTHov2v6wbHVxUwie4q8HLXcLIsYLLxRYF82XeVRIMF9nWs7LFBNlFyDCxCokBayep_KeKMPEAXHBu_DWaKGeWKhm2Bd4lnC3j0xZ_C-LNraRclFvnk1p96GyPYRZqYwfpgP5jZRhhXZVluaPRKBcFZkk1wODQNKQUO9BBaJ2=w778-h502-no" %}

Nos vemos en la siguiente entrada :D . . .
